%%
clc;
clear all;
close all;

fs=1000;
path = {'/Users/mac/Desktop/sp_cup/Grid_A/Power_recordings/Train_Grid_A_P1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_A/Power_recordings/Train_Grid_A_P2.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_A/Power_recordings/Train_Grid_A_P3.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_A/Power_recordings/Train_Grid_A_P4.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_A/Power_recordings/Train_Grid_A_P5.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_A/Power_recordings/Train_Grid_A_P6.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_A/Power_recordings/Train_Grid_A_P7.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_A/Power_recordings/Train_Grid_A_P8.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_A/Power_recordings/Train_Grid_A_P9.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_B/Power_recordings/Train_Grid_B_P1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_B/Power_recordings/Train_Grid_B_P2.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_B/Power_recordings/Train_Grid_B_P3.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_B/Power_recordings/Train_Grid_B_P4.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_B/Power_recordings/Train_Grid_B_P5.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_B/Power_recordings/Train_Grid_B_P6.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_B/Power_recordings/Train_Grid_B_P7.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_B/Power_recordings/Train_Grid_B_P8.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_B/Power_recordings/Train_Grid_B_P9.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_B/Power_recordings/Train_Grid_B_P10.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_C/Power_recordings/Train_Grid_C_P1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_C/Power_recordings/Train_Grid_C_P2.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_C/Power_recordings/Train_Grid_C_P3.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_C/Power_recordings/Train_Grid_C_P4.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_C/Power_recordings/Train_Grid_C_P5.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_C/Power_recordings/Train_Grid_C_P6.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_C/Power_recordings/Train_Grid_C_P7.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_C/Power_recordings/Train_Grid_C_P8.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_C/Power_recordings/Train_Grid_C_P9.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_C/Power_recordings/Train_Grid_C_P10.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_C/Power_recordings/Train_Grid_C_P11.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_D/Power_recordings/Train_Grid_D_P1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_D/Power_recordings/Train_Grid_D_P2.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_D/Power_recordings/Train_Grid_D_P3.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_D/Power_recordings/Train_Grid_D_P4.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_D/Power_recordings/Train_Grid_D_P5.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_D/Power_recordings/Train_Grid_D_P6.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_D/Power_recordings/Train_Grid_D_P7.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_D/Power_recordings/Train_Grid_D_P8.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_D/Power_recordings/Train_Grid_D_P9.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_D/Power_recordings/Train_Grid_D_P10.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_D/Power_recordings/Train_Grid_D_P11.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_E/Power_recordings/Train_Grid_E_P1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_E/Power_recordings/Train_Grid_E_P2.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_E/Power_recordings/Train_Grid_E_P3.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_E/Power_recordings/Train_Grid_E_P4.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_E/Power_recordings/Train_Grid_E_P5.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_E/Power_recordings/Train_Grid_E_P6.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_E/Power_recordings/Train_Grid_E_P7.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_E/Power_recordings/Train_Grid_E_P8.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_E/Power_recordings/Train_Grid_E_P9.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_E/Power_recordings/Train_Grid_E_P10.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_E/Power_recordings/Train_Grid_E_P11.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_F/Power_recordings/Train_Grid_F_P1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_F/Power_recordings/Train_Grid_F_P2.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_F/Power_recordings/Train_Grid_F_P3.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_F/Power_recordings/Train_Grid_F_P4.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_F/Power_recordings/Train_Grid_F_P5.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_F/Power_recordings/Train_Grid_F_P6.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_F/Power_recordings/Train_Grid_F_P7.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_F/Power_recordings/Train_Grid_F_P8.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_G/Power_recordings/Train_Grid_G_P1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_G/Power_recordings/Train_Grid_G_P2.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_G/Power_recordings/Train_Grid_G_P3.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_G/Power_recordings/Train_Grid_G_P4.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_G/Power_recordings/Train_Grid_G_P5.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_G/Power_recordings/Train_Grid_G_P6.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_G/Power_recordings/Train_Grid_G_P7.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_G/Power_recordings/Train_Grid_G_P8.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_G/Power_recordings/Train_Grid_G_P9.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_G/Power_recordings/Train_Grid_G_P10.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_G/Power_recordings/Train_Grid_G_P11.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_H/Power_recordings/Train_Grid_H_P1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_H/Power_recordings/Train_Grid_H_P2.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_H/Power_recordings/Train_Grid_H_P3.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_H/Power_recordings/Train_Grid_H_P4.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_H/Power_recordings/Train_Grid_H_P5.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_H/Power_recordings/Train_Grid_H_P6.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_H/Power_recordings/Train_Grid_H_P7.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_H/Power_recordings/Train_Grid_H_P8.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_H/Power_recordings/Train_Grid_H_P9.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_H/Power_recordings/Train_Grid_H_P10.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_H/Power_recordings/Train_Grid_H_P11.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_I/Power_recordings/Train_Grid_I_P1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_I/Power_recordings/Train_Grid_I_P2.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_I/Power_recordings/Train_Grid_I_P3.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_I/Power_recordings/Train_Grid_I_P4.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_I/Power_recordings/Train_Grid_I_P5.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_I/Power_recordings/Train_Grid_I_P6.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_I/Power_recordings/Train_Grid_I_P7.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_I/Power_recordings/Train_Grid_I_P8.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_I/Power_recordings/Train_Grid_I_P9.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_I/Power_recordings/Train_Grid_I_P10.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_I/Power_recordings/Train_Grid_I_P11.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_A/Audio_recordings/Train_Grid_A_A1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_A/Audio_recordings/Train_Grid_A_A2.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_B/Audio_recordings/Train_Grid_B_A1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_B/Audio_recordings/Train_Grid_B_A2.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_C/Audio_recordings/Train_Grid_C_A1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_C/Audio_recordings/Train_Grid_C_A2.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_D/Audio_recordings/Train_Grid_D_A1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_D/Audio_recordings/Train_Grid_D_A2.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_E/Audio_recordings/Train_Grid_E_A1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_E/Audio_recordings/Train_Grid_E_A2.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_F/Audio_recordings/Train_Grid_F_A1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_F/Audio_recordings/Train_Grid_F_A2.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_G/Audio_recordings/Train_Grid_G_A1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_G/Audio_recordings/Train_Grid_G_A2.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_H/Audio_recordings/Train_Grid_H_A1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_H/Audio_recordings/Train_Grid_H_A2.wav'...
        ...
        '/Users/mac/Desktop/sp_cup/Grid_I/Audio_recordings/Train_Grid_I_A1.wav'...
        '/Users/mac/Desktop/sp_cup/Grid_I/Audio_recordings/Train_Grid_I_A2.wav'...
        ...
        };
    
    
 files = {'AP1','AP2','AP3','AP4','AP5','AP6','AP7','AP8','AP9',...
          'BP1','BP2','BP3','BP4','BP5','BP6','BP7','BP8','BP9','BP10',...
          'CP1','CP2','CP3','CP4','CP5','CP6','CP7','CP8','CP9','CP10','CP11'...
          'DP1','DP2','DP3','DP4','DP5','DP6','DP7','DP8','DP9','DP10','DP11'...
          'EP1','EP2','EP3','EP4','EP5','EP6','EP7','EP8','EP9','EP10','EP11'...
          'FP1','FP2','FP3','FP4','FP5','FP6','FP7','FP8'...
          'GP1','GP2','GP3','GP4','GP5','GP6','GP7','GP8','GP9','GP10','GP11'...
          'HP1','HP2','HP3','HP4','HP5','HP6','HP7','HP8','HP9','HP10','HP11'...
          'IP1','IP2','IP3','IP4','IP5','IP6','IP7','IP8','IP9','IP10','IP11'...
          %'AA1','AA2','BA1','BA2','CA1','CA2','DA1','DA2','EA1','EA2',...
          %'FA1','FA2','GA1','GA2','HA1','HA2','IA1','IA2'...
          };
         
    grid = [1*ones(1,9) 2*ones(1,10) 3*ones(1,11) ...  %keeping a record of the
            4*ones(1,11) 5*ones(1,11) 6*ones(1,8) ...  %grid of the corresponding
            7*ones(1,11) 8*ones(1,11) 9*ones(1,11) ... %path
            1*ones(1,2) 2*ones(1,2) 3*ones(1,2) 4*ones(1,2) ...
            5*ones(1,2) 6*ones(1,2) 7*ones(1,2) ...
            8*ones(1,2) 9*ones(1,2) ]';  
        
    len = length(files);
    
    
 %%   
for jl = 1:len-18
    
    
    %%listing features
    var_x = [];
    mean_x = [];
    diff_x = [];
    wav_coef = [];
    wavcoef_n = [];
    range = [];
    AR_coef=[];
    
    
    pp=1; %initialization for wav_coef loop
    
%     if jl < 94
%         ENF_file = ['P_' num2str(jl)];
%     else
%         ENF_file = ['A_' num2str(jl-93)];
%     end
%     
%     fprintf('loading data from ....%s/n',ENF_file);
%     fprintf('recording no.  ---> %d/n',jl);
%    
%     load(ENF_file);

    fprintf('loading data from ....%s\n',char(path(jl)));
    fprintf('recording no.  ---> %d\n',jl);

    enf_win = 32;       %enf window
    win_time = .4;
    F = enf_extract_from_audio_and_power(char(path(jl)),win_time);

    %plot(F)
    x = F;

    %% Statistical feature
    

    for i = 2:enf_win:(length(x)-enf_win)        %window length enf_win samples
            
        m = mean(x(i:i+enf_win - 1));        %taking mean of enf_win samples at a time
        mean_x = [mean_x m];        %appending window mean to matrix

        v = log(var(x(i:i+enf_win - 1)));         %taking variance of enf_win samples at a time

        var_x = [var_x v];          %appending window variance to matrix

    end
    

    
    for i = 2:enf_win:(length(x)-enf_win)        %window length enf_win samples 

        d_m = abs(diff(x(i:i+enf_win - 1))); %make a difference matrix

        d1 = sort(d_m,'descend');
        
        d = (d1(1)+d1(2)+d1(3))/3;           %taking mean of max 3 differences

        diff_x = [diff_x d];

    end


   %% Wavelet based features

   F1=F/max(F);                         %normalize ENF
   
   feature_per_rcrd = 0;
   AR=ar(F,2);           %2nd order Autoregressive model
   bb=AR.a(2:3);
   
    for i = 2:enf_win:(length(F)-enf_win)
       AR_coef(:,pp)=bb;
       temp1= F(i:i+enf_win - 1);
       temp2=F1(i:i+enf_win - 1);                  % for normalized ENF

       [C, L]=wavedec(temp1,9,'haar');

       [C1, L1]=wavedec(temp2,9,'haar');      % for normalized ENF

        wav_coef(:,pp)=C;
        
        wavcoef_n(:,pp)=C1;
        
       rn = log(max(temp1)-min(temp1));   % take range of ENF
       range = [range rn];
       
        pp=pp+1;
        feature_per_rcrd = feature_per_rcrd + 1;

    end

    responsevar = grid(jl)*ones(1,feature_per_rcrd);
    
    

%%
%arranging training dataset 

    master_trainer = [ var_x' mean_x' diff_x' .....
                       AR_coef' wav_coef' range'];

    responsevar = responsevar';
    save([char(files(jl)) '_' num2str(win_time*1000)],'master_trainer','responsevar','var_x','mean_x',...
                         'diff_x', 'AR_coef', 'wav_coef', ...
                         'range', 'wavcoef_n');
end